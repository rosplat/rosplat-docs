
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://rosplat.github.io/rosplat-docs/">
      
      
      
        <link rel="next" href="deploy/">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>документация</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12.66%2013.67c-.34.33-.73.62-1.16.83V21l-2%202-2-2%202-1.71L8%2018l1.5-1.29-2-1.71v-.5a4.42%204.42%200%200%201-2.5-4C5%208%207%206%209.5%206h.11c-.02.07-.07.12-.11.18-.27.61-.42%201.25-.47%201.9A1.498%201.498%200%200%200%209.5%2011h.1c.64%201.25%201.74%202.2%203.06%202.67M16%206c0-.63-.1-1.25-.28-1.82%201.34.38%202.49%201.37%203.01%202.78.6%201.66.16%203.43-.98%204.63L20%2017.68l-1.22%202.57-2.56-1.2%201.28-2.29-1.84-.7.97-1.72-2.47-.93-.16-.46a4.48%204.48%200%200%201-3.73-2.91%204.51%204.51%200%200%201%202.69-5.77c.18-.06.37-.1.54-.14A3.95%203.95%200%200%200%2010%202C7.79%202%206%203.79%206%206c0%20.09%200%20.17.03.26-.33.27-.63.56-.88.89C5.06%206.78%205%206.4%205%206c0-2.76%202.24-5%205-5s5%202.24%205%205c0%201.16-.4%202.21-1.06%203.06C16.08%208.88%2016%206%2016%206m-3.19%202.1c.06.17.15.31.25.44.56-.66.91-1.5.94-2.43-.11.02-.2.04-.3.07-.78.29-1.2%201.15-.89%201.92%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
      <link rel="stylesheet" href="stylesheets/pdf.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="документация" class="md-header__button md-logo" aria-label="документация" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            документация
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              1.Подготовка
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="документация" class="md-nav__button md-logo" aria-label="документация" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    документация
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    1.Подготовка
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    1.Подготовка
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      Минимальная конфигурация для корректной работы кластера:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      Пример коммутации кластера Росплатформа:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      Пример минимальной конфигурации для кластера:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      Пример конфигураций с большим количеством дисков или массивом другого типа для увеличения производительности:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      Пропорциональность для расчета гибридного массива:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      Расчет ресурсов памяти и процессора:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      Расчет объема полезного хранения и количества узлов:
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="deploy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.Развертывание
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="decryption/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.По шагам
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="diagnostics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.Проверка
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="archi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.Архитектура
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      Минимальная конфигурация для корректной работы кластера:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      Пример коммутации кластера Росплатформа:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      Пример минимальной конфигурации для кластера:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      Пример конфигураций с большим количеством дисков или массивом другого типа для увеличения производительности:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      Пропорциональность для расчета гибридного массива:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      Расчет ресурсов памяти и процессора:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      Расчет объема полезного хранения и количества узлов:
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="_1"><strong>Подготовка конфигурации серверного оборудования по рекомендуемым требованиям ПО Росплатформы.</strong></h1>
<p _="%" endblock="endblock"><a class="pdfb" href="document.pdf"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 64C0 28.7 28.7 0 64 0h160v128c0 17.7 14.3 32 32 32h128v144H176c-35.3 0-64 28.7-64 64v144H64c-35.3 0-64-28.7-64-64zm384 64H256V0zM176 352h32c30.9 0 56 25.1 56 56s-25.1 56-56 56h-16v32c0 8.8-7.2 16-16 16s-16-7.2-16-16V368c0-8.8 7.2-16 16-16m32 80c13.3 0 24-10.7 24-24s-10.7-24-24-24h-16v48zm96-80h32c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48h-32c-8.8 0-16-7.2-16-16V368c0-8.8 7.2-16 16-16m32 128c8.8 0 16-7.2 16-16v-64c0-8.8-7.2-16-16-16h-16v96zm80-112c0-8.8 7.2-16 16-16h48c8.8 0 16 7.2 16 16s-7.2 16-16 16h-32v32h32c8.8 0 16 7.2 16 16s-7.2 16-16 16h-32v48c0 8.8-7.2 16-16 16s-16-7.2-16-16V368"/></svg></span></a></p>
<h4 id="_2">Минимальная конфигурация для корректной работы кластера:</h4>
<div style="text-align: justify">
<p>В каждом сервере не менее двух физических портов от 10Гбит для сети компонента Р-хранилище (данная сеть является внутренней сетью только для блочного уровня (<strong>SDS</strong>)). Отдельно на каждом сервере не менее двух физических портов от 1Гбит для сети компонента Р-управление (Сеть может быть связана с публичной и использована для виртуализации или доступа к <strong>s3</strong>).</p>
</div>
<details class="success" open="open">
<summary>Важно!</summary>
<p>Необходимо не менее 3 стоечных сервера архитектуры x86. </p>
</details>
<div style="text-align: justify">
<p>Для работоспособности всех сервисов платформы на каждом сервере не менее 64ГБ памяти и от 1-ого процессора с 8-ю или 10-ю физическими ядрами с частотой не менее 2Гигагерца. </p>
<p>Для установки операционной системы Росплатформы физический диск не менее 64ГБ объема. Опционально рекомендуется устанавливать на физический том состоящий из двух физических дисков с <strong>RAID1</strong> за счет аппаратного <strong>RAID</strong> контроллера на борту сервера для защиты операционной системы Росплатформы от сбоя одного из системных дисков (кэш контроллера желательно выключить).</p>
<p><strong>RAID1</strong> для системных дисков настраивается заранее перед началом установки Росплатформы за счет настроек биоса сервера или <strong>firmware</strong>, а для дисков под кластер Р-хранилища отключается.</p>
<p>Диски под систему могут быть как <strong>HDD</strong> так и <strong>SSD</strong> с не менее <strong>DWPD1</strong>. Предпочтительнее устанавливать под систему <strong>SSD</strong> так как в этом случае на системных дисках можно разместить службу метаданных от Р-хранилища, которая не требует большого дискового пространства(3ГБ свободного дискового пространства на 100ТБ данных в кластере). </p>
<p>Для организации блочного хранилища (<strong>SDS</strong>-Р-хранилища) с возможностью включения кластера необходимо не менее трех дисков на каждом сервере, желательно не менее гибридного массива, состоящего из одного <strong>SSD</strong> и двух <strong>HDD</strong>, где первый это <strong>SSD</strong> корпоративного уровня с <strong>DWPD</strong> не менее 3, с объемом не менее 100ГБ. Максимальный показатель последовательной скорости записи этого диска должен быть не меньше суммы скорости медленных дисков <strong>HDD</strong>. Два диска <strong>HDD</strong> должны быть так же не менее 100ГБ объемом. Все диски для хранилища должны быть презентованы по <strong>JBOD</strong> через <strong>HBA</strong> или на прямую через <strong>JBOD</strong> от интерфейса материнской платы или <strong>RAID</strong> контроллера, поддерживающего одновременную презентацию дисков для хранилища по <strong>JBOD</strong> и <strong>RAID1</strong> для системного диска. </p>
<p>Если не имеется возможность установить, как минимум гибридный набор дисков, то в этом случае можно использовать только <strong>HDD</strong> также презентованные по <strong>JBOD</strong>, но в этом случае скорость ввода вывода будет ниже, чем у гибридного или у массива, который будет состоять только из <strong>SSD</strong>. </p>
<p>В случае, когда все диски <strong>SSD</strong>, они должны быть не менее <strong>DWPD 1</strong> и в этом случае не требуется назначать роль КЭШ, все диски будут с ролью хранения, а на системном будет совместно использоваться роль метаданных.</p>
<p>Коммутация кластера из 3 или более серверов обеспечивается за счет не менее двух ethernet коммутаторов c поддержкой <strong>MLAG</strong> или <strong>VPC</strong>. На стороне серверов настраивается <strong>LACP</strong> в режиме:</p>
</div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">xmit-hash-policy=layer3+4</span><span class="w"> </span><span class="c1">#(1)</span>
</span></code></pre></div>
<ol>
<li><img alt="🙋" class="twemoji heart" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f64b.svg" title=":person_raising_hand:" /> опция в настройках сетевого интерфейса <strong>Bond</strong></li>
</ol>
<div style="text-align: justify">
<p>а также <strong>MTU9000</strong> для интерфейсов от 10Гбит и более. На стороне коммутаторов также необходима поддержка <strong>jumbo frame</strong>.</p>
<p>В случае больше количества дисков чем два для каждой ноды, где сумма скорости дисков превышает пропускную способность сети Р-хранилища желательно использовать 25Гбит или более вместо 10Гбит в агрегации для задействования всех скоростных возможностей дисков, так как синхронная репликация с подтверждением записи выполняется по сети Р-хранилища.</p>
<p>Сеть хранилища должна быть в режиме доступа(<strong>access</strong>) <strong>L2</strong>, то есть не в режиме <strong>Trunk</strong>. Адресация статическая без указания шлюза. Сеть для компонента Р-управления может быть в Trunk для разделения трафика управления от сети доступа и от сети виртуализации или <strong>S3</strong>, где каждый трафик в своем теге (<strong>VLAN</strong>).</p>
<p>Адресация в сети Р-управления также статическая, для доступа из других сетей или подключения интернета можно прописывать шлюз и <strong>DNS</strong> сервер. Статические адреса могут быть настроены через <strong>DHCP</strong> сервер для исключения появления большего количества шлюзов, прописываемых на сервере. Наличие нескольких шлюзов, прописанных непосредственно в настройках каждого сервера, не поддерживается и требует специальных настроек маршрутов, что усложняет сетевые настройки и сам процесс развертывания такой конфигурации.   </p>
</div>
<details class="success" open="open">
<summary>Важно!</summary>
<p>В случае использования <strong>S3</strong>, для балансировки нагрузки по сети доступа к <strong>S3</strong> между серверами или шлюзами <strong>S3</strong> используется внешние программные или аппаратные балансировщики.  </p>
</details>
<h4 id="_3">Пример коммутации кластера Росплатформа:</h4>
<figure>
  <img alt="Image title" src="schemSwitching.png" width="500" />
<br />
<figcaption></figcaption>
</figure>
<figure>
  <img alt="Image title" src="schemSwitching2.png" width="900" />
<br />
<figcaption></figcaption>
</figure>
<hr />
<h4 id="_4">Пример минимальной конфигурации для кластера:</h4>
<hr />
<p><strong>3 сервера:</strong></p>
<div style="text-align: left">
<ul>
<li>1 <strong>CPU</strong> 2Ггц 8-10 ядер</li>
<li><strong>RAM</strong> 64 GB+</li>
<li><strong>SAS/SATA</strong> <strong>HBA</strong>-адаптер с поддержкой режима <strong>JBOD</strong></li>
<li>для загрузки гипервизора/ОС - как минимум 1 диск с объемом не менее 100ГБ или два диска в <strong>RAID1</strong> средствами аппаратного <strong>RAID</strong>-контроллера</li>
<li>1 x <strong>SSD</strong> + 2 x <strong>HDD</strong> (гибридный массив) <strong>JBOD</strong> </li>
<li>2 x 10 <strong>Gbit Ethernet</strong> (отдельная сеть для хранилища данных)</li>
<li>2 x 1<strong>Gbit Ethernet</strong> (для сети управления и <strong>s3</strong> доступа)</li>
<li>два коммутатора <strong>Ethernet</strong> 1/10 Гбит портов в агрегации <strong>LACP</strong> с поддержкой <strong>MLAG</strong> или <strong>VPC</strong>.</li>
</ul>
</div>
<hr />
<h4 id="_5">Пример конфигураций с большим количеством дисков или массивом другого типа для увеличения производительности:</h4>
<hr />
<p><strong>5 серверов:</strong></p>
<div style="text-align: left">
<ul>
<li>2 x <strong>CPU</strong> 2Ггц 8-10 ядер </li>
<li><strong>RAM</strong> 128 GB</li>
<li><strong>SAS/SATA</strong> <strong>HBA</strong>-адаптер с поддержкой режима <strong>JBOD</strong></li>
<li>для загрузки гипервизора/ОС - как минимум 1 диск с объемом не менее 100ГБ или два диска в <strong>RAID1</strong> средствами аппаратного <strong>RAID</strong>-контроллера</li>
<li>2 x <strong>SSD</strong> (<strong>all flash</strong>), минимум 2 шт или более (самый быстрый массив, где роль кэш как в гибриде не используется). Все <strong>SSD</strong> диски с <strong>DWPD</strong> не менее 1.</li>
<li>2 x 10 <strong>Gbit Ethernet</strong> или 2 x 25 и более (отдельная сеть для хранилища данных)</li>
<li>2 x 10 <strong>Gbit Ethernet</strong> (для сети управления и виртуализации)</li>
</ul>
</div>
<hr />
<h4 id="_6">Пропорциональность для расчета гибридного массива:</h4>
<hr />
<div style="text-align: justify">
<p>На один <strong>SSD</strong> с ролю кэш подключается 3 или 4 <strong>HDD</strong> с ролью хранения. Если <strong>SSD</strong> больше одного, то на каждый по 3 или 4 <strong>HDD</strong>.  Количество <strong>HDD</strong> зависит от максимальной последовательной скорости записи <strong>SSD</strong>, то есть она не должна быть меньше, чем сумма скорости последовательной записи всех <strong>HDD</strong>, которые будут подключены к этому <strong>SSD</strong>. Например: если один <strong>SSD</strong> имеет максимальную скорость записи, заявленную производителем 1000МБ/c, а диски <strong>HDD</strong> c <strong>RPM</strong> 10K в среднем показывают 250МБ/c, то 1000/250=4(диска <strong>HDD</strong>).</p>
<p>Для массива <strong>all-flash</strong> роль кэш не используется, и все диски идут с ролью хранения, 
При этом все диски должны быть с одинаковыми скоростными показателями и объемом. </p>
</div>
<p><strong>Пропорциональность расчета пропускной способности сети для внутреннего блочного взаимодействия хранилища следующая:</strong></p>
<div style="text-align: justify">
<p>Сумма скорости всех <strong>SSD</strong> дисков одного сервера должна соответствовать возможности пропускного канала сети хранения блочного уровня. Например, если один диск <strong>SSD</strong> имеет скорость последовательной записи, заявленной производителем 1000МБ/c то умножив на 8 бит мы получим 8Гбит необходимый пропускной канал для этого диска. Соответственно если на борту одного сервера 10 таких дисков, то пропускной канал сети блочного уровня должен быть не менее 80Гбит. В случае использования только 2x10Гбит, то максимальная скорость записи для одной реплики будет 2250МБ/c (18Гбит) деленная на количество узлов, которые одновременно записывают.</p>
</div>
<pre class="mermaid"><code>graph LR
  A[запись] --&gt; B{сервер №n};
  B --&gt;|копия блока| C[коммутатор];
  C --&gt; D{сервер №n+1};
  D --&gt;|подтверджение записи| C[коммутатор];
  C --&gt; B;</code></pre>
<h4 id="_7">Расчет ресурсов памяти и процессора:</h4>
<p><strong>CPU:</strong></p>
<ul>
<li>Не менее 8-10 физических ядер на сервер. </li>
<li>Для операционной системы Росплатформы необходимо не менее 4 ядер.</li>
<li>Управление 0.5-1 ядро.</li>
<li>Для службы метаданных блочного уровня одно ядро (одна служба на один сервер).</li>
<li>Для сервисов блочного хранения на одно ядро 8 дисков.</li>
<li>Для сервиса клиента блочного уровня (точка монтирования для протокола <strong>fastpath</strong> (<strong>TCP/IP</strong>), одна точка на один сервер) 1 ядро.</li>
<li>Для сервисов <strong>S3</strong> 1.7 ядро.</li>
</ul>
<p><strong>RAM:</strong></p>
<ul>
<li>Не менее 64ГБ памяти на сервер.</li>
<li>Для операционной системы Росплатформы не менее 4-5ГБ. </li>
<li>Управление 2-4ГБ. </li>
<li>Для службы метаданных блочного уровня - 1ГБ на 100ТБ данных. </li>
<li>Для сервисов блочного хранения - 1ГБ на каждую службу (диск).</li>
<li>Для сервиса клиента блочного уровня - 1ГБ.</li>
<li>Для сервисов <strong>S3</strong> - 8ГБ.</li>
</ul>
<details class="success" open="open">
<summary>Важно!</summary>
<p>Ресурсы необходимые для виртуальных сред добавляются в конфигурацию поверх вышеописанных.</p>
</details>
<h4 id="_8">Расчет объема полезного хранения и количества узлов:</h4>
<div style="text-align: justify">
<p>Р-Хранилище поддерживает ряд режимов для каждого метода избыточности. В 
таблице ниже представлены издержки данных для разных режимов избыточности. 
Первые три строки относятся к репликации, остальные – к избыточному кодированию.</p>
</div>
<table>
<thead>
<tr>
<th>Режим избыточности</th>
<th>Минимальное число необходиммых серверов</th>
<th>Допустимное число отказавших серверов</th>
<th>Издержки хранилища,%</th>
<th>Неразмеченое пространство,требуемое для хранения 100ГБ данных</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 реплика без избыточности</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>100ГБ</td>
</tr>
<tr>
<td>2 реплики</td>
<td>2</td>
<td>1</td>
<td>100</td>
<td>200ГБ</td>
</tr>
<tr>
<td>3 реплики</td>
<td>3</td>
<td>2</td>
<td>200</td>
<td>300ГБ</td>
</tr>
<tr>
<td>дирование 1+0 (без избыточности)</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>100ГБ</td>
</tr>
<tr>
<td>Кодирование 1+2</td>
<td>3</td>
<td>2</td>
<td>200</td>
<td>300ГБ</td>
</tr>
<tr>
<td>Кодирование 3+2</td>
<td>5</td>
<td>2</td>
<td>67</td>
<td>167ГБ</td>
</tr>
<tr>
<td>Кодирование 5+2</td>
<td>7</td>
<td>2</td>
<td>40</td>
<td>140ГБ</td>
</tr>
<tr>
<td>Кодирование 7+2</td>
<td>9</td>
<td>2</td>
<td>29</td>
<td>129ГБ</td>
</tr>
<tr>
<td>Кодирование 17+3</td>
<td>20</td>
<td>3</td>
<td>18</td>
<td>118ГБ</td>
</tr>
</tbody>
</table>
<div class="admonition success">
<p class="admonition-title">Примечание:</p>
<p>Режимы избыточного кодирования 1+0 и 1+2 предназначены для небольших кластеров с недостаточным числом серверов для использования других режимов избыточного кодирования, но которые планируется расширить в будущем. Так как после выбора типа избыточности его невозможно поменять (с репликации на избыточное кодирование, или наоборот), данный режим позволяет выбрать избыточное кодирование, даже если кластер не соответствует рекомендациям. После расширения кластера можно выбрать более полезный режим избыточности.</p>
</div>
<div style="text-align: justify">
<p>Кроме выше приведенной таблицы необходимо учитывать Кворум на базе алгоритма <strong>Paxos</strong>, где должно оставаться большинство нод в случае выхода из строя. Например, при минимальной конфигурации из трех или четырех серверов может выйти из строя только один сервер, независимо от того, что настроена реплика 2 или реплика 3. При конфигурации из 5 серверов и реплики 3 может из строя выйти только два сервера. Кворум контролируется на уровне служб метаданных поэтому на каждом сервере по одной такой службе. При большом количестве серверов (больше чем 5) на последующих серверах можно не делать службу метаданных или делать по одной службе на одном из серверов из группы. </p>
<p>Для применения кодирования используются быстрые массивы, начиная от гибридного, где на один <strong>SSD</strong> подключается 3-4 <strong>HDD</strong>, быстрые <strong>all-flash</strong>, где все диски <strong>SSD</strong>, или возможно использование гибридного <strong>all-flash</strong>, где <strong>NVMe</strong> или <strong>intel Optane</strong> в три или четыре раза быстрее обычного <strong>SSD</strong>, В этом случае на один <strong>NVMe</strong> в роли кэша на 3-4 <strong>SSD</strong>. </p>
</div>
<details class="success" open="open">
<summary>Важно!</summary>
<p>Количество дисков на сервер в среднем считается 20 дисков на узел. Большее число узлов с меньшем количеством дисков предпочтительнее, чем большее количество дисков на один сервер в кластере с минимальным числом серверов. Конфигурация из 5 или 10 серверов, где каждый сервер по 20 дисков будет лучше, чем всего 5 серверов, где каждый сервер по 60 дисков. </p>
</details>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
        
          
          <a href="deploy/" class="md-footer__link md-footer__link--next" aria-label="Next: 2.Развертывание">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                2.Развертывание
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["content.code.copy", "content.code.select", "content.code.annotate", "navigation.footer"], "search": "assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>